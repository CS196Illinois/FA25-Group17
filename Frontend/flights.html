<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Buking.com | Flights</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Buking<span>.com</span></h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="flights.html">Flights</a>
      <a href="planner.html">Planner</a>
      <a href="itinerary.html">Itinerary</a>
    </nav>
  </header>

  <section class="flights">
    <div class="flight-search">
      <h2>Find Flights</h2>
      <form id="flightForm">
        <input type="text" id="origin" placeholder="Origin city" required>
        <input type="text" id="destination" placeholder="Destination city" required>
        <input type="date" id="date" required>
        <input type="date" id="returnDate">
        <input type="number" id="adults" min="1" value="1" required>
        <button type="submit">Search</button>
      </form>
    </div>

    <div id="loading" style="display:none;">Loading flights...</div>
    <div id="results"></div>

    <h2>Available Flights</h2>

    <div class="flight-card">
      <h3>Qatar</h3>
      <p>London → New York</p>
      <p>3:30 pm - 10:05 am</p>
      <p><b>$889</b></p>
      <button>Book Now</button>
    </div>

    <div class="flight-card">
      <h3>Emirates</h3>
      <p>London → New York</p>
      <p>4:30 am - 11:00 am</p>
      <p><b>$1069</b></p>
      <button>Book Now</button>
    </div>
  </section>
  <script>
  document.getElementById('flightForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const data = {
      origin: document.getElementById('origin').value,
      destination: document.getElementById('destination').value,
      date: document.getElementById('date').value,
      returnDate: document.getElementById('returnDate').value || "",
      adults: document.getElementById('adults').value
    };

    document.getElementById('loading').style.display = 'block';

    try {
      const response = await fetch('http://127.0.0.1:5000/search', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      const flights = await response.json();
      console.log(flights);
      document.getElementById('loading').style.display = 'none';
      displayFlights(flights);
    } catch (error) {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('results').innerHTML = `<p>Error: ${error.message}</p>`;
    }
  });

  function displayFlights(flights) {
    const resultsDiv = document.getElementById('results');
    resultsDiv.innerHTML = ''; // clear old results
    if (!flights || flights.length === 0) {
      resultsDiv.innerHTML = '<p>No flights found.</p>';
      return;
    }

    flights.forEach(f => {
      const card = document.createElement('div');
      card.className = 'flight-card';
      card.innerHTML = `
        <h3>${f.airline || 'Unknown Airline'}</h3>
        <p>${f.origin} → ${f.destination}</p>
        <p>${f.departureTime} - ${f.arrivalTime}</p>
        <p><b>${f.price}</b></p>
        <button>Book Now</button>
      `;
      resultsDiv.appendChild(card);
    });
  }
  </script>

</body>
</html>
